{% extends "layout.html" %}
{% block content %}

<h2>{{ event[2] }}</h2>

<div style="margin: 20px 0;">
    <a href="../event_list" style="background-color: #888; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px;">一覧に戻る</a>
</div>

<!-- イベント詳細情報 -->
<table border="1" style="border-collapse: collapse; width: 100%; margin: 20px 0;">
    <tr>
        <th style="background-color: #f0f0f0; padding: 10px; text-align: left; width: 20%;">項目</th>
        <th style="background-color: #f0f0f0; padding: 10px; text-align: left;">内容</th>
    </tr>
    <tr>
        <td style="padding: 10px; font-weight: bold;">イベント名</td>
        <td style="padding: 10px;">{{ event[2] }}</td>
    </tr>
    <tr>
        <td style="padding: 10px; font-weight: bold;">開催日</td>
        <td style="padding: 10px;">{{ event[3] }}</td>
    </tr>
    <tr>
        <td style="padding: 10px; font-weight: bold;">開催時間</td>
        <td style="padding: 10px;">{{ event[4] }} ~ {{ event[5] }}</td>
    </tr>
    <tr>
        <td style="padding: 10px; font-weight: bold;">開催場所</td>
        <td style="padding: 10px;">{{ event[6] }}</td>
    </tr>
    <tr>
        <td style="padding: 10px; font-weight: bold;">参加費</td>
        <td style="padding: 10px;">{{ event[7] }}円</td>
    </tr>
    <tr>
        <td style="padding: 10px; font-weight: bold;">募集人数</td>
        <td style="padding: 10px;">{{ event[8] }}人</td>
    </tr>
    <tr>
        <td style="padding: 10px; font-weight: bold;">現在の参加者数</td>
        <td style="padding: 10px;">
            {% if event[14] >= event[8] %}
                <span style="color: red; font-weight: bold;">{{ event[14] }}人（募集終了）</span>
            {% else %}
                <span>{{ event[14] }}人</span>
            {% endif %}
        </td>
    </tr>
    <tr>
        <td style="padding: 10px; font-weight: bold;">キャンセル期限</td>
        <td style="padding: 10px;">{{ event[9] if event[9] else '設定なし' }}</td>
    </tr>
    <tr>
        <td style="padding: 10px; font-weight: bold;">中止の場合</td>
        <td style="padding: 10px;">{{ event[10] if event[10] else '設定なし' }}</td>
    </tr>
    <tr>
        <td style="padding: 10px; font-weight: bold;">募集締切</td>
        <td style="padding: 10px;">{{ event[11] }}</td>
    </tr>
    <tr>
        <td style="padding: 10px; font-weight: bold;">主催者</td>
        <td style="padding: 10px;">{{ event[13] }}</td>
    </tr>
    <tr>
        <td style="padding: 10px; font-weight: bold; vertical-align: top;">詳細</td>
        <td style="padding: 10px; white-space: pre-wrap;">{{ event[12] if event[12] else '詳細情報なし' }}</td>
    </tr>
</table>

<!-- 参加ボタン / 参加取消ボタン -->
<div style="margin: 20px 0;">
    {% if is_joined %}
        <form method="POST" style="display: inline;">
            <input type="hidden" name="action" value="leave">
            <input type="submit" value="参加をキャンセル" style="background-color: #f44336; color: white; padding: 10px 20px; border: none; cursor: pointer; border-radius: 4px;">
        </form>
        <span style="color: green; margin-left: 10px;">✓ 参加登録済み</span>
    {% elif event[14] >= event[8] %}
        <button disabled style="background-color: #ccc; color: #666; padding: 10px 20px; border: none; border-radius: 4px;">募集終了</button>
    {% else %}
        <form method="POST" style="display: inline;">
            <input type="hidden" name="action" value="join">
            <input type="submit" value="参加する" style="background-color: #4CAF50; color: white; padding: 10px 20px; border: none; cursor: pointer; border-radius: 4px;">
        </form>
    {% endif %}
</div>

<!-- 主催者の場合のみ編集・削除ボタンを表示 -->
{% if event[1] == uid %}
<div style="margin: 20px 0; padding: 15px; background-color: #f9f9f9; border: 1px solid #ddd; border-radius: 4px;">
    <h3>主催者メニュー</h3>
    <a href="/edit_event/{{ event[0] }}" style="background-color: #FF9800; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; margin-right: 10px;">イベントを編集</a>
    <form method="POST" action="/delete_event/{{ event[0] }}" style="display: inline;" onsubmit="return confirm('本当にこのイベントを削除しますか？')">
        <input type="submit" value="イベントを削除" style="background-color: #f44336; color: white; padding: 10px 20px; border: none; cursor: pointer; border-radius: 4px;">
    </form>
</div>
{% endif %}

<!-- 参加者一覧 -->
<h3>参加者一覧 ({{ participants|length }}人)</h3>
{% if participants %}
<table border="1" style="border-collapse: collapse; width: 100%; margin: 20px 0;">
    <thead>
        <tr style="background-color: #f0f0f0;">
            <th style="padding: 10px; text-align: left;">参加者名</th>
            <th style="padding: 10px; text-align: left;">登録日時</th>
        </tr>
    </thead>
    <tbody>
        {% for participant in participants %}
        <tr>
            <td style="padding: 10px;">{{ participant[0] }}</td>
            <td style="padding: 10px;">{{ participant[1].strftime('%Y年%m月%d日 %H:%M') }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p style="padding: 20px; background-color: #f9f9f9; border: 1px solid #ddd; border-radius: 4px; text-align: center;">
    まだ参加者がいません。
</p>
{% endif %}

{% endblock %}